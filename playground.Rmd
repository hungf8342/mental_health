---
title: "Playground"
author: "Frances Hung"
date: "10/21/2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning=FALSE)
```
## Motivation

According to the CDC, suicide was the 10th leading cause of death in the US in 2015, and the 2nd leading cause of death among adolescents and young adults. Psychological disorders, particularly depression, are a significant risk factor for suicide especially when they go untreated. There is no reliable way to predict who is at risk for committing suicide, because most screening approaches depend on self-report information and people contemplating on suicide would often deny it when asked. However, even if someone wouldn't tell the truth on a questionnaire, they will often tell Google. Using suicide rate and mental health treatment facilities data as well as Google search term data, our project aims to map the demand for and supply of mental health treatment in California cities.

- use result/visualization as hook

## Playground


```{r}
require(gtrendsR)
require(ggplot2)
require(dplyr)
require(ggmap)
```

## Making Dataframes

This gives us a master dataframe of search frequencies of “depression” over the past 12 months in the US which relate for sure to mental health. We can take different dataframes using "$": see the dataframe for details.

```{r}
trend<-gtrends("suicide",c("US"),time="today 12-m")
trend$interest_by_region
```

For example, this gives us search frequencies by cities in CA in the U.S.

```{r}
cities_longlat<-read.csv("cal_cities.csv",header=TRUE) %>% select(c(location,Latitude,Longitude))
cities_dep<-gtrends("depression",c("US-CA"),time="today 12-m")$interest_by_city
cities_dep<-cities_dep %>% inner_join(cities_longlat,by="location")

write.csv(cities_dep,file="cities_top49.csv")
```

This plots cities_dep.

```{r}
ggplot(cities_dep,aes(x=reorder(location,hits),y=hits))+geom_bar(stat="identity")+theme(axis.text.x = element_text(angle = 90, hjust = 1))
```
```{r}

for (i in 1:length(cities_dep$location)) {
  place=geocode(cities_dep$location[i],output="latlon",source="dsk")
  cities_dep$lat[i]=as.numeric(place[1])
  cities_dep$lon[i]=as.numeric(place[2])
}
```

```{r}
center=as.numeric(geocode("United States",source="dsk"))
mappy<-get_map(c(-119.4179,36.7783),zoom=6,scale=2,maptype = "terrain",source="google")
p=ggmap(mappy,extent="device",ylab="Latitude",xlab="Longitude")
p=p+geom_point(data=cities_dep,aes(x=lat,y=lon),size=(cities_dep$hits/50)^2)
p
```


```{r}
suis<-read.csv(file="death.csv",header=TRUE)
suis %>% filter(Causes.of.Death=="SUI") %>% filter(Year==2010)
```


facilities data
```{r}
facilities <- read_csv("filtered_licensed-healthcare-facility-listing-june-30-2017.csv")
facilities <- filter(facilities, LICENSE_CATEGORY_DESC == "Acute Psychiatric Hospital"|LICENSE_CATEGORY_DESC == "Psychiatric Health Facility" | LICENSE_CATEGORY_DESC =="Psychology Clinic")
View(facilities)
write.csv(facilities, file="facilities.csv")
```


